<mat-card class="order-summary bg-white">
  <mat-card-header>
    <mat-card-subtitle>Resumen de compra</mat-card-subtitle>
  </mat-card-header>
  <hr />
  <!-- Cart Items Table -->
  <mat-card-content>
    <mat-table [dataSource]="carritoTable" class="w-100">
      <!-- CANTIDAD Column -->
      <ng-container matColumnDef="cantidad">
        <mat-header-cell *matHeaderCellDef>CANTIDAD</mat-header-cell>
        <mat-cell *matCellDef="let item" class="mt-3">
          <!-- @if (item.idServicio==1) {
          <mat-form-field [formGroup]="getRangeForm(item)" appearance="outline">
            <input
              type="number"
              formControlName="dias"
              matInput
              (change)="
                actualizarCantidad(
                  item,
                  getRangeForm(item).get('dias')?.value || 0
                )
              "
            />
            <mat-date-range-input [rangePicker]="picker" class="d-none">
              <input matStartDate formControlName="start" />
              <input matEndDate formControlName="end" />
            </mat-date-range-input>
            <mat-datepicker-toggle
              matIconSuffix
              [for]="picker"
            ></mat-datepicker-toggle>
            <mat-date-range-picker #picker></mat-date-range-picker>
          </mat-form-field>
          }@else{
          <mat-form-field
            [formGroup]="getRangeForm(item)"
            appearance="outline"
            class="w-75"
          >
            <input
              matInput
              type="number"
              formControlName="cantidad"
              min="1"
              (change)="
                actualizarCantidad(
                  item,
                  getRangeForm(item).get('cantidad')?.value || 0
                )
              "
            />
          </mat-form-field>
          } -->
        </mat-cell>
      </ng-container>

      <!-- Product Name Column -->
      <ng-container matColumnDef="producto">
        <mat-header-cell *matHeaderCellDef>PRODUCTO</mat-header-cell>
        <mat-cell *matCellDef="let item">
          <div class="product-info">
            <span class="product-name">{{ item.nombre }}</span>
            <small class="text-muted d-block">{{ item.descripcion }}</small>
            @if (item.alojados && item.alojados.length > 0) {
              <small class="badge bg-info">{{ item.alojados.length }} alojados</small>
            }
          </div>
        </mat-cell>
      </ng-container>

      <!-- VU Column -->
      <ng-container matColumnDef="vu">
        <mat-header-cell *matHeaderCellDef>VU</mat-header-cell>
        <mat-cell *matCellDef="let item" class="mt-3">
          <mat-form-field appearance="outline">
            <mat-select
              [(value)]="item.precio1"
              (selectionChange)="cambiarPrecio(item, $event.value)"
            >
              @if (item.idServicio==1) {
              <mat-option [value]="item.precio1">{{ item.precio1 }}</mat-option>
              <mat-option [value]="item.precio2">{{ item.precio2 }}</mat-option>
              <mat-option [value]="item.precio3">{{ item.precio3 }}</mat-option>
              }@else{
              <mat-option [value]="item.precio1">{{ item.precio1 }}</mat-option>

              }
            </mat-select>
          </mat-form-field>
        </mat-cell>
      </ng-container>

      <!-- subt -->
      <ng-container matColumnDef="subtotal">
        <mat-header-cell *matHeaderCellDef>SUBT</mat-header-cell>
        <mat-cell *matCellDef="let item">{{
          item.subtotal | currency : "S/ "
        }}</mat-cell>
      </ng-container>

      <!-- ob Column -->
      <ng-container matColumnDef="ob">
        <mat-header-cell *matHeaderCellDef>OPCIONES</mat-header-cell>
        <mat-cell *matCellDef="let item; let i = index">
          <div class="d-flex flex-row align-items-center justify-content-center w-100">
            <!-- Early/Late checkboxes for hotel service (id=1) -->
            <!-- @if (item.idServicio==1) {
                <div class="mb-1 me-2 d-flex flex-column gap-1" [formGroup]="getCheckboxForm(item)">
                <mat-checkbox class="small-checkbox align-items-center" labelPosition="before" color="primary" formControlName="checkbox1">
                  <small  >Early</small>
                </mat-checkbox>
                <mat-checkbox class="small-checkbox align-items-center" labelPosition="before" color="primary" formControlName="checkbox2">
                  <small >Late</small>
                </mat-checkbox>
              </div>
            } -->
            
            <!-- Action buttons -->
            <div class="d-flex flex-column gap-2">
              <button mat-icon-button color="warn" 
                      matTooltip="Eliminar producto" 
                      aria-label="Eliminar Ã­tem"
                      >
                <mat-icon>delete</mat-icon>
              </button>
              
              <button mat-icon-button color="primary"
                      matTooltip="Agregar persona" 
                      aria-label="Agregar persona"
                      (click)="openAddPersonModal(item)">
                <mat-icon>person_add</mat-icon>
              </button>
            </div>
          </div>
        </mat-cell>
      </ng-container>

      <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
      <mat-row
        *matRowDef="let row; let i = index; columns: displayedColumns"
      ></mat-row>
    </mat-table>
    <br />

    <!-- <div class="d-flex justify-content-between mb-2">
      <span>Sub-Total:</span>
      <span>{{ subtotal | currency:'S/ ' }}</span>
    </div>
    <div class="d-flex justify-content-between mb-2">
      <span>IGV (18%):</span>
      <span>{{ vat | currency:'S/ ' }}</span>
    </div> -->
    <hr />
    <div class="d-flex justify-content-between mb-2 font-weight-bold">
      <span>Total:</span>
      <!-- <span>{{ carritoService.total$ | async | currency : "S/ " }}</span> -->
    </div>
  </mat-card-content>
</mat-card>
